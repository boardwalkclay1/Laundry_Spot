<!DOCTYPE html>
<html>
<head>
  <title>My Requests</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .job-card {
      background: rgba(10, 15, 30, 0.9);
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

<div class="container">
  <h2>My Requests</h2>
  <button onclick="location.href='customer-dashboard.html'" style="float:right;">Back to Dashboard</button>

  <div id="list"></div>
</div>

<script>
function getUser() {
  let user = localStorage.getItem("laundryUser");
  if (!user) user = sessionStorage.getItem("laundryUser");
  return user ? JSON.parse(user) : null;
}

const user = getUser();
if (!user || user.role !== "customer") {
  location.href = "login.html?role=customer";
}

async function loadRequests() {
  try {
    const res = await fetch('/api/jobs');
    const data = await res.json();
    const jobs = (data.jobs || []).filter(j => j.customerName === user.email);

    const container = document.getElementById('list');
    container.innerHTML = '';

    if (!jobs.length) {
      container.innerHTML = "<p>You don't have any requests yet.</p>";
      return;
    }

    jobs.forEach(job => {
      const div = document.createElement('div');
      div.className = 'job-card';
      div.innerHTML = `
        <p><strong>Type:</strong> ${job.type || 'N/A'}</p>
        <p><strong>Address:</strong> ${job.address}</p>
        <p><strong>Status:</strong> ${job.status}</p>
        <p><strong>Notes:</strong> ${job.notes || ''}</p>
      `;
      container.appendChild(div);
    });
  } catch (e) {
    document.getElementById('list').innerText = "Error loading requests.";
  }
}

loadRequests();
</script>

</body>
</html>
